# Optuna Bayesian Optimization Configuration (US-17.9)
# Epic 17: AI-Native Research Lab
# Compatible with Optuna 4.5.0+

optuna:
  # Database storage for study persistence and distributed optimization
  storage:
    url: postgresql://mlflow:mlflow_secure_password@postgres:5432/mlflow
    # Note: Using shared PostgreSQL database with MLflow for simplicity

  # Sampler configuration - Tree-structured Parzen Estimator (TPE)
  sampler:
    type: TPESampler
    n_startup_trials: 10  # Random sampling before TPE kicks in
    n_ei_candidates: 24   # Number of candidates for Expected Improvement
    multivariate: false   # Use univariate optimization for interpretability

  # Pruner configuration - Median pruner for early stopping
  pruner:
    type: MedianPruner
    n_startup_trials: 5   # Trials before pruning starts
    n_warmup_steps: 10    # Steps before pruning evaluation
    interval_steps: 1     # Check pruning every step

  # Optimization settings
  optimization:
    n_trials: 100         # Total number of trials per study
    n_jobs: 4            # Parallel workers (matches Docker container count)
    timeout: 3600        # Max time per study in seconds (1 hour)
    show_progress_bar: true

  # Study management
  study:
    direction: maximize   # maximize or minimize objective
    load_if_exists: true  # Resume existing studies

  # Parameter constraints and validation
  constraints:
    max_parallel_backtests: 4  # Limit concurrent backtest execution
    memory_limit_gb: 8        # Memory limit per worker
    timeout_per_trial: 300    # Max seconds per trial

  # Logging and monitoring
  logging:
    log_level: INFO
    mlflow_tracking: true     # Enable MLflow integration
    async_logging: true       # Use async logging to reduce overhead
    save_study_plots: true    # Generate optimization plots
    plot_dir: results/optuna_plots/

  # Default parameter spaces (can be overridden by strategy-specific configs)
  default_param_spaces:
    sma_period: {type: int, low: 5, high: 200, step: 5}
    rsi_period: {type: int, low: 2, high: 50}
    rsi_threshold: {type: int, low: 20, high: 80}
    stop_loss: {type: float, low: 0.01, high: 0.20, step: 0.01}
    take_profit: {type: float, low: 0.02, high: 0.50, step: 0.02}
    position_size: {type: float, low: 0.1, high: 1.0, step: 0.1}